<div ng-controller="BottlingCtrl">
    <div class="col-md-10">
        <div class="panel panel-default">
            <div class="panel-heading">
                <strong>Embotellado</strong>
            </div>
            <div class="panel-body" >
                <ul class="list-group">
                    <li class="list-group-item" style="overflow: hidden;">
                        <div class="col-md-2">
                            <strong>A embotellar:</strong>
                        </div>
                        <div class="col-md-10">
                            <span style="display: inline" class="form-control input-sm gt-calculated ">
                                {{estimateLiters(recipe.fermentation.stages.length)|number:2}} Ltrs
                            </span>
                        </div>
                    </li>
                    <li class="list-group-item" style="overflow: hidden;">
                        <div class="col-md-2">
                            <strong>Embotellado:</strong>
                        </div>
                        <div class="col-md-10">
                            <span style="display: inline" class="form-control input-sm gt-calculated ">
                                {{bottledLiters()|number:2}} Ltrs
                            </span>
                        </div>
                    </li>
                    <li class="list-group-item" style="overflow: hidden;">
                        <div class="col-md-2">
                            <strong>Restante:</strong>
                        </div>
                        <div class="col-md-10">
                            <span style="display: inline" ng-class="leftClass(estimateLiters(recipe.fermentation.stages.length)-bottledLiters())" class="form-control input-sm ">
                                {{estimateLiters(recipe.fermentation.stages.length)-bottledLiters()|number:2}} Ltrs
                            </span>
                        </div>
                    </li>
                </ul>
                
                
                <div class="alert alert-info" ng-hide="recipe.bottling.bottles.length!=0">
                    No ha cargado ninguna botella aun,
                    <a href="" ng-click="addBottle()" class="alert-link">Agrega una botella!</a>
                </div>
                <div ng-show="recipe.bottling.bottles.length!=0">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Tipo</th>
                                <th style="width:10em">Tamaño</th>
                                <th style="width:10em">Cantidad</th>
                                <th style="width:10em">Total</th>
                                <th style="width:10em">Carbonatacion</th>
                                <th style="width:3em"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="bottle in recipe.bottling.bottles">
                                <td>
                                    <input class="form-control input-sm" type="text" ng-model="bottle.bottleType" placeholder="(Tipo: porron, medio, litro, corni)"/>
                                </td>
                                <td>
                                    <input ng-blur="subTotal=round2(bottle.size*bottle.amount)" ng-change="bottle.amount=round(subTotal/bottle.size)" class="form-control input-sm" type="number" step="0.001" ng-model="bottle.size" placeholder="(Tamaño)"/>
                                </td>
                                <td>
                                    <input ng-change="subTotal=round2(bottle.size*bottle.amount)" class="form-control input-sm" type="number" ng-model="bottle.amount" placeholder="(Cantidad)"/>
                                </td>
                                <td>
                                    <input ng-change="bottle.amount=round(subTotal/bottle.size)" ng-init="subTotal=round2(estimateLiters(recipe.fermentation.stages.length)-bottledLiters())" class="form-control input-sm" type="number" ng-model="subTotal" placeholder="(Litros)" value="liters" />
                                </td>
                                <td>
                                    <select class="form-control input-sm" ng-model="bottle.carbonatationType">
                                        <option value="sugar">Azucar</option>
                                        <option value="must">Mosto</option>
                                        <option value="co2">CO2</option>
                                    </select>
                                </td>
                                <td>
                                    <button ng-click="recipe.bottling.bottles.splice($index,1);"
                                            type="button"
                                            class="close" aria-hidden="true">&times;</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>                    
                    <button type="button" ng-click="addBottle()" class="btn btn-default pull-right">Agregar Botella</button>
                    
                </div>
                <!--<div class="panel panel-default" style="margin-top: 5em">
                    <div class="panel-heading"><strong>Resumen y graficos</strong></div>
                    <div class="panel-body" >
                        <ul class="list-group">
                            <li class="list-group-item">
                                <strong>Duracion Total: </strong>{{calculateDays(recipe.fermentation)}}
                            </li>
                            <li class="list-group-item">
                                <strong>Volumen final: </strong>{{estimateLiters(recipe.fermentation.stages.length)|number:1}} Litros
                            </li>
                            <li class="list-group-item">
                                <strong>Volumen perdido: </strong>{{recipe.BATCH_SIZE - estimateLiters(recipe.fermentation.stages.length)|number:1}} Litros
                            </li>
                            <li class="list-group-item">
                                <strong>Si comienzo el: </strong>
                                <input ng-change="updateChart()" ng-model="simulatedDate_day" type="number" class="form-control input-sm " style="width: 50px;display: inline" />
                                <input ng-change="updateChart()" ng-model="simulatedDate_month" type="number" class="form-control input-sm " style="width: 50px;display: inline" />
                                <input ng-change="updateChart()" ng-model="simulatedDate_year" type="number" class="form-control input-sm " style="width: 70px;display: inline" />
                                <span style="margin-left: 1em;">terminaria en</span> 
                                <span title="Fecha estimada de fin de proceso de fermentacion/maduracion, a esto falta sumarle el tiempo de carbonatacion"
                                      style="font-weight: bold; width:90px; display: inline"
                                      class="form-control input-sm gt-calculated ">{{estimateEnd(simulatedDate_day,simulatedDate_month,simulatedDate_year,recipe.fermentation)|date:'dd-MM-yyyy'}}</span> 
                            </li>
                        </ul>
                    </div>
                    <div class="panel-body" >
                        <div google-chart chart="chart" ng-style="chart.cssStyle"></div>    
                    </div>
                </div>-->
            </div>
        </div>
        <div style="overflow: hidden;margin-bottom: 1em;">
            <div class="pull-left">
                <a href="#/recipe/" type="button" class="btn btn-link glyphicon glyphicon-chevron-left"> Volver al listado</a>
            </div>
            <div class="pull-right">
                <a href="#/recipe/" type="button" class="btn btn-default">Cancelar</a>
                <button ng-click="save()" type="button" class="btn btn-primary">Guardar</button>
            </div>
        </div>
        <div ng-repeat="notification in notifications">
            <div class="alert alert-{{notification.type}} alert-dismissable">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                <strong>{{notification.title}}</strong>
                {{notification.text}}
            </div>
        </div>            
    </div>
    <div class="col-md-2" >
        <ng-include src="'partial/recipe-detail-indicators.html'"></ng-include>
        <ng-include src="'partial/recipe-detail-social.html'"></ng-include>
    </div>
</div>