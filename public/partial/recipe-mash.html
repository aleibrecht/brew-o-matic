<div ng-controller="RecipeMashCtrl">
    <div class="col-md-10">
        <div class="panel panel-default">
            <div class="panel-heading"><strong>Empaste</strong></div>
            <div class="panel-body" >
                <div class="row">
                    <div class="col-lg-3">
                        <label for="batch_size">Batch</label>
                        <span class="form-control input-sm gt-calculated" id="batch_size" >
                            {{recipe.BATCH_SIZE}} Lts
                        </span>
                    </div>
                    <div class="col-lg-3">
                      <label for="OG">OG</label>
                      <span class="form-control input-sm gt-calculated" id="OG" ng-bind="recipe.OG" />
                    </div>
                    <div class="col-lg-3">
                        <label for="totalWater">Agua total</label>
                        <span class="form-control input-sm gt-calculated" id="totalWater"
                              ng-bind="round1(BrewCalc.calculateBoilSize(recipe.BATCH_SIZE, recipe.TrubChillerLosses, recipe.BOIL_TIME, recipe.PercentEvap, recipe.TopUpWater)+recipe.SpargeDeadSpace+(recipe.GrainAbsorbtion*recipe.totalAmount)) + ' Lts'" />
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-3">
                        <label for="totalGrain">Total Granos</label>
                        <span class="form-control input-sm gt-calculated" id="totalGrain">
                            {{recipe.totalAmount|number:3}} Kg
                        </span>
                    </div>
                    <div class="col-lg-3">
                        <label for="grainTemp">Temp granos (Cº)</label>
                        <input type="number" class="form-control input-sm" id="grainTemp" ng-model="recipe.GrainTemp" />
                    </div>
                    <div class="col-lg-3">
                        <label for="strikeWater">Agua inicial (L)</label>
                        <input ng-change="recipe.WatertoGrainRatio=round1(recipe.StrikeWater/recipe.totalAmount)" type="number" class="form-control input-sm" id="strikeWater" step="0.1" ng-model="recipe.StrikeWater" />
                    </div>
                    <div class="col-lg-3">
                        <label for="watertoGrainRatio">Empaste (L/Kg)</label>
                        <input ng-change="recipe.StrikeWater=round1(recipe.WatertoGrainRatio*recipe.totalAmount)" type="number" class="form-control input-sm" id="watertoGrainRatio" step="0.1" ng-model="recipe.WatertoGrainRatio" />
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-3">
                        <label for="initMashTemp">T. Macerado</label>
                        <input type="number" class="form-control input-sm" id="initMashTemp" ng-model="recipe.mashTemp" />
                    </div>
                    <div class="col-lg-3">
                        <label for="tempStrikeWater">T. Agua Inicial</label>
                        <span class="form-control input-sm gt-calculated" id="tempStrikeWater"  >
                            {{(strikeWaterTemp())|number:0}} ºC
                        </span>
                    </div>
                    <div class="col-lg-3">
                        <label for="lossMashTemp" title="Temperatura q pierden los granos luego de ser mezclados">Perdida (ºC)</label>
                        <input type="number" class="form-control input-sm gt-preset" id="lossMashTemp" ng-model="recipe.lossMashTemp" />
                    </div>
                    <div class="col-lg-3">
                        <label for="mashVolume">Volumen Total</label>
                        <span class="form-control input-sm gt-calculated" id="mashVolume" title="Valor Aproximado que ocupa la malta mas el agua en el macerador">
                            {{BrewCalc.initialMashVolume(recipe.StrikeWater,recipe.totalAmount)|number:1}} Lts
                        </span>
                    </div>
                </div>
            </div>
            <!-- Expandida -->
            
            <div class="panel-heading"><strong>Escalones</strong></div>
            <div class="panel-body" >
                <div class="alert alert-info" ng-hide="recipe.MASH.MASH_STEPS.MASH_STEP.length!=0">
                    No ha creado ningun escalon.
                    <a href="" ng-click="addMashStep()" class="alert-link">Agrega el primero!</a>
                </div>
                <div ng-show="recipe.MASH.MASH_STEPS.MASH_STEP.length!=0">
                    <ul class="list-group">
                        <li style="padding-top: 5px;" class="list-group-item" ng-repeat="STEP in recipe.MASH.MASH_STEPS.MASH_STEP">
                            <button ng-click="recipe.MASH.MASH_STEPS.MASH_STEP.splice($index,1);updateChart();"
                                    type="button"
                                    style="margin-top: 7px;margin-right: 5px;"
                                    class="close" aria-hidden="true">&times;</button>
                            <button ng-disabled="$first"
                                    ng-click="moveUp(STEP,$index);updateChart();"
                                    type="button"
                                    style="margin-top: 7px;"
                                    class="gt-fermentation-stage-btn-move pull-right glyphicon glyphicon-chevron-up"></button>
                            <button ng-disabled="$last"
                                    ng-click="moveDown(STEP,$index);updateChart();"
                                    type="button"
                                    style="margin-top: 7px;"
                                    class="gt-fermentation-stage-btn-move pull-right glyphicon glyphicon-chevron-down"></button>
                            
                            <input ng-focus="onFocus=true"
                                   title="Haga click para editar el titulo"
                                   ng-blur="onFocus=false;updateChart();"
                                   id="step_title"
                                   style="padding-left: 5px;margin-left: -5px;margin-bottom: 1em"
                                   ng-style="styleTitle(onFocus)"
                                   class="form-control gt-fermentation-stage-title"
                                   type="text"
                                   ng-model="STEP.NAME"
                                   placeholder="(Clic para ingresar un titulo)"/>
                            <div class="row">
                                <div class="col-md-2">
                                    <label for="temp">Temp (Cº): </label>
                                    <input id="temp" ng-blur="updateChart();" class="form-control input-sm" type="number" ng-model="STEP.STEP_TEMP" placeholder="Temperatura"/>
                                </div>
                                <div class="col-md-2">
                                    <label for="temp_fin">Final (Cº): </label>
                                    <input ng-change="addWaterVol(STEP)" id="temp_fin" ng-blur="updateChart();" class="form-control input-sm" type="number" ng-model="STEP.END_TEMP" placeholder="Temperatura Final"/>
                                </div>
                                <div class="col-md-2">
                                    <label for="duration">Duracion (min): </label>
                                    <input id="duration" ng-blur="updateChart();" class="form-control input-sm" type="number" ng-model="STEP.STEP_TIME" placeholder="Duracion"/>
                                </div>
                                <div class="col-md-2">
                                    <label title="Volumen final del escalon (malta+agua)" for="finalVol">Vol. final (Lts): </label>
                                    <span class="form-control input-sm gt-calculated" >
                                        {{ calculateVolume($index) }} Lts
                                    </span>
                                </div>
                                <div class="col-md-2">
                                    <label s>Modo: </label>
                                    <select class="form-control input-sm" ng-change="changeAction(STEP, actionValue)" ng-model="actionValue" ng-init="actionValue=initActionValue(STEP)">
                                        <option value="0">(Sin accion)</option>
                                        <option value="1">Agregar Agua</option>
                                        <option value="2">Decoccion</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                   <div class="checkbox" title="Recircula?" style="margin-top: 2em;">
                                        <label>
                                            <input ng-change="updateChart()" type="checkbox" ng-model="STEP.recirculate" />
                                            Recircula? 
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 1em">
                                <form class="form-inline" role="form">
                                    <div class="col-md-2">
                                        <strong ng-show="STEP.infuse" >Agregar agua</strong>
                                        <strong ng-show="STEP.decoction" >Decoccion</strong>
                                    </div>
                                    <div class="col-md-2" style="text-align: right;">
                                        <label ng-show="STEP.infuse||STEP.decoction" >Volumen: </label>
                                    </div>
                                    <div class="col-md-2">
                                        <input ng-show="STEP.infuse" ng-blur="updateChart();" class="form-control input-sm" type="number" ng-model="STEP.INFUSE_AMOUNT" placeholder="(Litros)"/>
                                        <input ng-show="STEP.decoction" ng-blur="updateChart();" class="form-control input-sm" type="number" ng-model="STEP.DECOCTION_AMT" placeholder="(Litros)"/>
                                    </div>
                                    <div class="col-md-2" style="text-align: right;">
                                        <label ng-show="STEP.infuse" for="INFUSE_TEMP">Temp (Cº): </label>
                                    </div>
                                    <div class="col-md-2">
                                        <input ng-change="addWaterVol(STEP)" id="INFUSE_TEMP" ng-show="STEP.infuse" ng-blur="updateChart();" class="form-control input-sm" type="number" ng-model="STEP.INFUSE_TEMP" placeholder="(C°)"/>
                                    </div>
                                </form>
                            </div>
                        </li>
                    </ul>
                    <button type="button" ng-click="addMashStep()" class="btn btn-default pull-right">Agregar Escalon</button>
                </div>
            </div>
            <!--STEPS compacta-->
<!--            <div class="panel-heading"><strong>Escalones</strong></div>
            <div class="panel-body" >
                <div class="alert alert-info" ng-hide="recipe.MASH.MASH_STEPS.MASH_STEP.length!=0">
                    No ha creado ningun escalon.
                    <a href="" ng-click="addMashStep()" class="alert-link">Agrega el primero!</a>
                </div>
                <div ng-show="recipe.MASH.MASH_STEPS.MASH_STEP.length!=0">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th style="width:6em">T. Inicial</th>
                                <th style="width:6em">T. Final</th>
                                <th style="width:4em">Duracion (min)</th>
                                <th style="width:3em">Agrega Agua?</th>
                                <th title="Agua agregada" style="width:6em">Agua Ag.</th>
                                <th title="Temperatura del Agua agregada" style="width:6em">T. Agua Ag.</th>
                                <th style="width:3em">Vol. Decoccion</th>
                                <th style="width:3em">Volumen Final</th>
                                <th style="width:3em">Recircula</th>
                                <th>Notas</th>
                                <th style="width:7em"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="STEP in recipe.MASH.MASH_STEPS.MASH_STEP">
                                <td>
                                    <input ng-blur="updateChart()" class="form-control input-sm" type="text" ng-model="STEP.NAME" placeholder="(Nombre)"/>
                                </td>
                                <td>
                                    <input ng-blur="updateChart();" class="form-control input-sm" type="number" ng-model="STEP.STEP_TEMP" placeholder="Temperatura"/>
                                </td>
                                <td>
                                    <input ng-blur="updateChart();" class="form-control input-sm" type="number" ng-model="STEP.END_TEMP" placeholder="Temperatura Final"/>
                                </td>
                                <td>
                                    <input ng-blur="updateChart();" class="form-control input-sm" type="number" ng-model="STEP.STEP_TIME" placeholder="Duracion"/>
                                </td>
                                <td>
                                    <div class="checkbox" title="Agrega agua al macerado?" >
                                        <input ng-change="updateChart()" type="checkbox" ng-model="STEP.infuse" />
                                    </div>
                                </td>
                                <td>
                                    <input ng-disabled="!STEP.infuse" ng-blur="updateChart();" class="form-control input-sm" type="number" ng-model="STEP.INFUSE_AMOUNT" placeholder="(Litros)"/>
                                </td>
                                <td>
                                    <input ng-disabled="!STEP.infuse" ng-blur="updateChart();" class="form-control input-sm" type="number" ng-model="STEP.INFUSE_TEMP" placeholder="(C°)"/>
                                </td>
                                <td>
                                    <input ng-blur="updateChart();" class="form-control input-sm" type="number" ng-model="STEP.DECOCTION_AMT" placeholder="(Litros)"/>
                                </td>
                                <td>
                                    <span class="form-control input-sm gt-calculated" >
                                        {{ calculateVolume($index) }} Lts
                                    </span>
                                </td>
                                <td>
                                    <div class="checkbox" title="Recircula?" >
                                        <input ng-change="updateChart()" type="checkbox" ng-model="STEP.recirculate" />
                                    </div>
                                </td>
                                <td>
                                    <input ng-blur="updateChart();" class="form-control input-sm" type="text" ng-model="STEP.DESCRIPTION" placeholder="(Notas)"/>
                                </td>
                                <td>
                                    <button ng-click="recipe.MASH.MASH_STEPS.MASH_STEP.splice($index,1);updateChart();"
                                            type="button"
                                            class="close" aria-hidden="true">&times;</button>
                                    <button ng-disabled="$first"
                                            ng-click="moveUp(STEP,$index);updateChart();"
                                            type="button"
                                            class="gt-fermentation-stage-btn-move pull-right glyphicon glyphicon-chevron-up"></button>
                                    <button ng-disabled="$last"
                                            ng-click="moveDown(STEP,$index);updateChart();"
                                            type="button"
                                            class="gt-fermentation-stage-btn-move pull-right glyphicon glyphicon-chevron-down"></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" ng-click="addMashStep()" class="btn btn-default pull-right">Agregar Escalon</button>
                </div>
            </div>-->
            <div class="panel-heading"><strong>Lavado</strong></div>
            <div class="panel-body" >
                <div class="row">
                    <div class="col-lg-2">
                        <label for="spargeTempDesired">Temperatura</label>
                        <input type="number"  class="form-control input-sm" id="spargeTempDesired" step="0.1" ng-model="recipe.SpargeTempDesired" />
                    </div>
                    <div class="col-lg-2">
                        <label for="spargeWater">Cantidad Agua</label>
                        <span class="form-control input-sm gt-calculated" id="spargeWater"
                              ng-bind="round1(BrewCalc.calculateBoilSize(recipe.BATCH_SIZE, recipe.TrubChillerLosses, recipe.BOIL_TIME, recipe.PercentEvap, recipe.TopUpWater)-recipe.StrikeWater-recipe.TopUpWater+recipe.SpargeDeadSpace+(recipe.GrainAbsorbtion*recipe.totalAmount)) + ' Lts'" />
                    </div>
                    <div class="col-lg-2">
                        <label title="Litros perdidos en el lavado (por ejemplo debajo del FF)" for="spargeDeadSpace">Espacio Muerto</label>
                        <input type="number"  class="form-control input-sm gt-preset" id="spargeDeadSpace" step="0.1" ng-model="recipe.SpargeDeadSpace" />
                    </div>
                    <div class="col-lg-2">
                        <label title="Litros de agua que quedan en el bagazo por cada Kg de malta" for="grainAbsorbtion">Absorcion (L/Kg)</label>
                        <input type="number"  class="form-control input-sm gt-preset" id="grainAbsorbtion" step="0.1" ng-model="recipe.GrainAbsorbtion" />
                    </div>
                </div>
            </div>
        </div>
        <div style="overflow: hidden;margin-bottom: 1em;">
            <div class="pull-left">
                <a href="#/recipe/" type="button" class="btn btn-link glyphicon glyphicon-chevron-left"> Volver al listado</a>
            </div>
            <div class="pull-right">
                <a href="#/recipe/" type="button" class="btn btn-default">Cancelar</a>
                <button ng-click="save()" type="button" class="btn btn-primary">Guardar</button>
            </div>
        </div>
        <div ng-repeat="notification in notifications">
            <div class="alert alert-{{notification.type}} alert-dismissable">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                <strong>{{notification.title}}</strong>
                {{notification.text}}
            </div>
        </div>            
    </div>
    <div class="col-md-2" >
        <ng-include src="'partial/recipe-detail-indicators.html'"></ng-include>
        <ng-include src="'partial/recipe-detail-social.html'"></ng-include>
    </div>
</div>