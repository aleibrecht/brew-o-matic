<!DOCTYPE html>
<html ng-app="index">
  <head>
    <title>Brew-o-Matic</title>
    <link rel='stylesheet' href='/css/style.css' />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <script src="http://code.jquery.com/jquery.js"></script>    
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular-resource.min.js"></script>
    <script src="js/index.js"></script>
    <script src="js/RecipeListCtrl.js"></script>
    <script src="js/RecipeDetailCtrl.js"></script>
    <script src="js/Data.js"></script>
    <script src="js/ObjTree.js"></script>
  </head>
  <body ng-controller="MainController" id="MainController">
    <div id="fb-root"></div>
    <!--<script src="js/fb.js"></scsript>-->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
      <a class="navbar-brand" href="#">
        Brew-o-Matic <!--<button class="btn btn-xs btn-danger">beta</button>-->
      </a>
      <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
                <a  href="#" class="dropdown-toggle" data-toggle="dropdown"><span id="email"></span><b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li><a href="javascript:disconnectUser()">Desconectar</a></li>
                </ul>
            </li>
        </ul>
        <span id="signinButton" class="navbar-form navbar-right">
          <span
            class="g-signin"
            data-callback="signinCallback"
            data-clientid="819410194566.apps.googleusercontent.com"
            data-cookiepolicy="single_host_origin"
            data-requestvisibleactions="http://schemas.google.com/AddActivity"
            data-scope="https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile">
          </span>
        </span>
      </div>
      </div>
    </nav>
    <div class="container" style="margin-top: 1em;">
      <div class="row" >
        <div class="col-md-2" >
          <div class="panel panel-default" style="max-width:200px; max-height:200px;">
            <div class="panel-body" >
              <img src="images/logo.jpg" style="max-width:100%; max-height:100%;"/>
            </div>
          </div>
        </div>
        <div class="col-md-10" >
          <ol class="breadcrumb">
            <li ng-repeat="item in breadcrumbs">
              <a ng-hide="$last" href="{{item.link}}">{{item.title}}</a>
              <span ng-show="$last" class="active" >{{item.title}}</span>
            </li>
          </ol>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row" >
        <div class="col-md-2">
          <div class="panel panel-default">
            <div class="panel-heading"><strong>Opciones</strong></div>
            <div class="panel-body">
              
            </div>
          </div>
        </div>
        <div class="col-md-10">
          <div ng-view></div>
        </div>
      </div>
      <!--<footer>-->
      <!--  <fb:login-button show-faces="true" width="200" max-rows="1"></fb:login-button>-->
      <!--</footer>-->
    </div>
    <script type="text/javascript">
        var access_token;
        function disconnectUser() {
            var revokeUrl = 'https://accounts.google.com/o/oauth2/revoke?token=' +
                    access_token;

            // Realiza una solicitud GET asíncrona.
            $.ajax({
                type: 'GET',
                url: revokeUrl,
                async: false,
                contentType: "application/json",
                dataType: 'jsonp',
                success: function(nullResponse) {
                    // Lleva a cabo una acción ahora que el usuario está desconectado
                    // La respuesta siempre está indefinida.

                    document.getElementById('signinButton').setAttribute('style', 'display: block');
                    document.getElementById('email').innerHTML = '';
                },
                error: function(e) {
                    // Gestiona el error
                    // console.log(e);
                    // Puedes indicar a los usuarios que se desconecten de forma manual si se produce un error
                    // https://plus.google.com/apps
                }
            });
        }
        // Se puede activar la desconexión haciendo clic en un botón
        $('#revokeButton').click(disconnectUser);
    </script>
    <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/client:plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
      

      
      function signinCallback(authResult) {
        if (authResult['access_token']) {
          // Autorizado correctamente
          // Oculta el botón de inicio de sesión ahora que el usuario está autorizado, por ejemplo:
          
          gapi.auth.setToken(authResult);
    access_token = authResult['access_token'];
          gapi.client.load('oauth2', 'v2', function() {
            var request = gapi.client.oauth2.userinfo.get();
            request.execute(function (obj){
                var el = document.getElementById('email');
                var email = '';

                if (obj.name) {
                    el.innerHTML = obj.name;
                } else if (obj['email']) {
                    el.innerHTML = 'Email: ' + obj['email'];
                }

            });
          });
          
          document.getElementById('signinButton').setAttribute('style', 'display: none');
        } else if (authResult['error']) {
          // Se ha producido un error.
          // Posibles códigos de error:
          //   "access_denied": el usuario ha denegado el acceso a la aplicación.
          //   "immediate_failed": no se ha podido dar acceso al usuario de forma automática.
          // console.log('There was an error: ' + authResult['error']);
        }
      }
    </script>    
  </body>
  
</html>